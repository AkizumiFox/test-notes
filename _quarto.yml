project:
  type: book
  output-dir: _book

# Don't re-execute code in CI - use frozen results
execute:
  freeze: true

# Use pre-compiled mermaid SVGs in CI
filters:
  - mermaid-static

book:
  title: "Advanced Linear Algebra Notes"
  subtitle: "Spectral Theory & Optimization"
  author: "Tzu-You Lin"
  date: last-modified
  downloads: [pdf]
  # AUTO-GENERATED CHAPTERS - Do not edit manually
  # Run 'make update' to regenerate from src/ directory
  chapters:
    - index.qmd

    - part: src/ch01-foundations/index.qmd
      chapters:
        - src/ch01-foundations/01-vector-spaces.qmd
        - src/ch01-foundations/02-linear-maps.qmd

    - part: src/ch02-spectral-theory/index.qmd
      chapters:
        - src/ch02-spectral-theory/01-eigenvalues.qmd
        - src/ch02-spectral-theory/02-decompositions.qmd

    - part: src/ch03-optimization/index.qmd
      chapters:
        - src/ch03-optimization/01-convex-optimization.qmd

    - part: src/ch04-quarto-showcase/index.qmd
      chapters:
        - src/ch04-quarto-showcase/01-features.qmd
        - src/ch04-quarto-showcase/02-interactive.qmd

format:
  html:
    theme: cosmo
    toc: true
    number-sections: true
    code-tools: true
    html-math-method: mathjax
    css: config/html-styles.css
    include-after-body:
      text: |
        <script>
        document.addEventListener('DOMContentLoaded', function() {
          // ==========================================
          // 1. Add PDF download link to right TOC sidebar
          // ==========================================
          var path = window.location.pathname;
          
          if (!path.endsWith('/') && !path.endsWith('/index.html') && path !== '/index.html') {
            var pdfPath = path.replace(/\.html$/, '.pdf');
            var section = document.createElement('div');
            section.style.cssText = 'margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #dee2e6;';
            section.innerHTML = 
              '<h6 style="font-size:0.875rem;font-weight:600;margin-bottom:0.5rem;">Other Formats</h6>' +
              '<a href="' + pdfPath + '" style="display:flex;align-items:center;gap:0.5rem;color:inherit;text-decoration:none;font-size:0.875rem;">' +
              '<i class="bi bi-file-pdf" style="color:#dc3545;"></i> PDF</a>';
            
            var tocSidebar = document.querySelector('#quarto-margin-sidebar') ||
                             document.querySelector('.toc-active') ||
                             document.querySelector('#TOC');
            if (tocSidebar) {
              tocSidebar.appendChild(section);
            }
          }
        });
        </script>
    
  pdf:
    documentclass: extbook
    classoption: [13.5pt, a4paper, oneside, openany]
    number-sections: true
    colorlinks: true
    linkcolor: "blue"
    urlcolor: "blue"
    pdf-engine: lualatex
    linestretch: 1.1
    fig-width: 6
    fig-pos: "H"
    include-in-header:
      - text: |
          \usepackage[quartoenv]{./config/latex-template}
          % Strip numbers from unnumbered theorem environments
          \directlua{require("config/strip-numbers")}
          % Remove blank pages
          \usepackage{etoolbox}
          \makeatletter
          \patchcmd{\chapter}{\if@openright\cleardoublepage\else\clearpage\fi}{\clearpage}{}{}
          % Suppress title page
          \AtBeginDocument{\let\maketitle\relax}
          \makeatother
          % List spacing (1.3x)
          \usepackage{enumitem}
          \setlist{itemsep=1.2em, parsep=0pt}
          % Custom enumeration with prefix: \begin{customenum}{VS} gives VS1, VS2, ...
          \newlist{customenum}{enumerate}{1}
          \setlist[customenum,1]{label=\customenumprefix\arabic*, itemsep=1.2em}
          \newcommand{\customenumprefix}{}
          \usepackage{./config/chapter-style}
    geometry:
      - margin=1.2in
